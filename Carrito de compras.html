<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script defer src="carrito.js"></script>
    <title>Carrito de Compras</title>
</head>
<body>
    <nav>
        <div class="nav-bar">
            <i class='bx bx-menu sidebarOpen'></i>
            <span class="logo navLogo"><a href="INICIO.html"><img src="images/LOGO STRAW2.png" alt="LOGO EN FORMA DE FRESA" class="logo-image"></a></span>
            <div class="menu">
                <div class="logo-toggle">
                    <span class="logo"><a href="INICIO.html">STRAWBERRY</a></span>
                    <i class='bx bx-x siderbarClose'></i>
                </div>
                <ul class="nav-links">
                    <li><a href="INICIO.html">Inicio</a></li>
                    <li><a href="INICIO.html">Catálogo</a></li>
                    <li><a href="#">Marcas</a></li>
                </ul>
            </div>
            
            <div class="header-container">
                <div class="cart-user-container">
                    <div class="darkLight-searchBox">
                        <div class="dark-light">
                            <i class='bx bx-moon moon'></i>
                            <i class='bx bx-sun sun'></i>
                        </div>
                        <div class="searchBox">
                            <div class="searchToggle">
                                <i class='bx bx-x cancel'></i>
                                <i class='bx bx-search search'></i>
                            </div>
                            <div class="search-field">
                                <input type="text" placeholder="Search...">
                                <i class='bx bx-search'></i>
                            </div>
                        </div>
                    </div>
                    <div class="user">
                        <a href="#"><i class='bx bx-user-circle'></i></a>
                    </div>

                    <div class="cart">
                        <a href="#"><i class='bx bx-cart'></i></a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <section class="cart container">
        <h1>Carrito de Compras</h1>
        <div class="cart-items">
            <!-- Los productos se agregarán dinámicamente aquí -->
        </div>
        <div class="cart-total">
            <h3>Total: $<span id="total">0.00</span></h3>
            <button id="checkoutBtn">Comprar</button>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartItemsContainer = document.querySelector('.cart-items');
            const totalElement = document.getElementById('total');

            let total = 0;

            // Un objeto para agrupar productos por ID
            const productMap = {};

            cart.forEach(item => {
                if (productMap[item.id]) {
                    productMap[item.id].quantity += item.quantity;
                } else {
                    productMap[item.id] = { ...item };
                }
            });

            // Crear elementos HTML para cada producto en el mapa
            Object.values(productMap).forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.classList.add('cart-item');
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.title}">
                    <div class="cart-item-details">
                        <h4>${item.title}</h4>
                        <p>$${item.price.toFixed(2)} x ${item.quantity}</p>
                        <button class="remove-btn" data-id="${item.id}">Eliminar</button>
                    </div>
                `;
                cartItemsContainer.appendChild(cartItem);

                total += item.price * item.quantity;
            });

            totalElement.textContent = total.toFixed(2);

            document.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const id = button.getAttribute('data-id');
                    const index = cart.findIndex(item => item.id === id);
                    if (index > -1) {
                        cart.splice(index, 1);
                        localStorage.setItem('cart', JSON.stringify(cart));
                        location.reload();
                    }
                });
            });

            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (cart.length > 0) {
                    const confirmPurchase = confirm('¿Quieres comprar estos productos?');
                    if (confirmPurchase) {
                        alert('Gracias por tu compra.');
                        localStorage.removeItem('cart');
                        location.reload();
                    }
                } else {
                    alert('Tu carrito está vacío.');
                }
            });
        });
    </script>
</body>
</html>
